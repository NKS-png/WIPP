import{supabase as n}from"./supabase.DCKg3lBM.js";import"./index.C1Qlw3jS.js";const c=new Audio("https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3");c.volume=.5;const L=document.getElementById("signup-form"),y=document.getElementById("avatar-upload"),B=document.getElementById("avatar-preview"),v=document.getElementById("avatar-img"),x=document.getElementById("avatar-icon"),i=document.getElementById("submitBtn"),w=document.getElementById("btnText"),h=document.getElementById("btnSpinner"),a=document.getElementById("statusMessage");let o=null;B?.addEventListener("click",()=>y.click());y.addEventListener("change",t=>{const e=t.target;if(e.files&&e.files[0]){o=e.files[0];const s=new FileReader;s.onload=d=>{d.target?.result&&(v.src=d.target.result,v.classList.remove("hidden"),x?.classList.add("hidden"),c.currentTime=0,c.play().catch(()=>{}))},s.readAsDataURL(o)}});L.addEventListener("submit",async t=>{t.preventDefault(),c.play().catch(()=>{});const e=document.getElementById("email").value,s=document.getElementById("password").value,d=document.getElementById("confirm-password").value,m=document.getElementById("full-name").value;if(a.className="hidden text-sm text-center py-2 rounded-lg mt-4",s!==d){u("Passwords do not match","error");return}E(!0);try{const{data:r,error:g}=await n.auth.signUp({email:e,password:s,options:{data:{full_name:m}}});if(g)throw g;if(!r.user)throw new Error("No user returned");const{error:f}=await n.from("profiles").upsert({id:r.user.id,email:e,full_name:m,updated_at:new Date().toISOString()},{onConflict:"id"});if(f&&console.warn("Manual profile creation warning:",f),o)try{const l=o.name.split(".").pop(),p=`${r.user.id}/avatar.${l}`,{error:b}=await n.storage.from("avatars").upload(p,o);if(!b){const{data:I}=n.storage.from("avatars").getPublicUrl(p);await n.from("profiles").update({avatar_url:I.publicUrl}).eq("id",r.user.id)}}catch(l){console.warn("Avatar upload skipped:",l)}u("Account created! Redirecting...","success"),setTimeout(()=>window.location.href="/login?message=Account created",1500)}catch(r){u(r.message||"Something went wrong","error"),E(!1)}});function E(t){t?(i.disabled=!0,i.classList.add("opacity-80","cursor-not-allowed"),w.textContent="Creating Account...",h.classList.remove("hidden")):(i.disabled=!1,i.classList.remove("opacity-80","cursor-not-allowed"),w.textContent="Create Account",h.classList.add("hidden"))}function u(t,e){a.textContent=t,a.classList.remove("hidden"),e==="error"?(a.classList.add("bg-red-50","text-red-500","border","border-red-100","animate-shake"),a.classList.remove("bg-green-50","text-green-500")):(a.classList.add("bg-green-50","text-green-500","border","border-green-100"),a.classList.remove("bg-red-50","text-red-500","animate-shake"))}
