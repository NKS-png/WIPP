---
/**
 * ResponsiveContainer Component
 * Provides responsive container with mobile-first design and proper padding
 * Implements viewport width compliance and horizontal scroll prevention
 * Requirements: 2.1, 2.2
 */

export interface Props {
  maxWidth?: 'sm' | 'md' | 'lg' | 'xl' | 'full';
  padding?: 'none' | 'sm' | 'md' | 'lg';
  class?: string;
  as?: 'div' | 'section' | 'article' | 'main';
  /** Enable strict mobile viewport compliance */
  strictMobile?: boolean;
  /** Enable content fitting for mobile */
  mobileContentFit?: boolean;
}

const { 
  maxWidth = 'lg', 
  padding = 'md', 
  class: className = '',
  as: Element = 'div',
  strictMobile = true,
  mobileContentFit = true
} = Astro.props;

// Mobile-first responsive max-width classes
const maxWidthClasses = {
  sm: 'max-w-sm sm:max-w-md md:max-w-lg',
  md: 'max-w-md sm:max-w-lg md:max-w-2xl lg:max-w-4xl', 
  lg: 'max-w-lg sm:max-w-xl md:max-w-3xl lg:max-w-5xl xl:max-w-6xl',
  xl: 'max-w-xl sm:max-w-2xl md:max-w-4xl lg:max-w-6xl xl:max-w-7xl',
  full: 'max-w-full'
};

// Mobile-first padding classes with proper touch spacing
const paddingClasses = {
  none: '',
  sm: 'px-4 sm:px-6',
  md: 'px-4 sm:px-6 md:px-8',
  lg: 'px-4 sm:px-6 md:px-8 lg:px-12'
};

// Build container classes with mobile-first approach
const containerClasses = [
  'w-full',
  'mx-auto',
  'responsive-container',
  maxWidthClasses[maxWidth],
  paddingClasses[padding],
  strictMobile && 'mobile-viewport-safe',
  mobileContentFit && 'mobile-content-fit',
  className
].filter(Boolean).join(' ');
---

<Element class={containerClasses}>
  <slot />
</Element>

<style>
  /* Enhanced mobile viewport compliance and horizontal scroll prevention */
  :global(.responsive-container) {
    /* Ensure container never exceeds viewport */
    max-width: 100vw;
    min-width: 0; /* Allow shrinking below content width */
    box-sizing: border-box;
    
    /* Prevent horizontal overflow */
    overflow-x: hidden;
    
    /* Ensure all child elements respect container bounds */
    word-wrap: break-word;
    overflow-wrap: break-word;
  }
  
  /* Strict mobile viewport safety */
  :global(.mobile-viewport-safe) {
    /* Prevent any horizontal scrolling on mobile */
    max-width: calc(100vw - 1px); /* Account for potential scrollbar */
    overflow-x: hidden;
    
    /* Ensure content fits within viewport */
    contain: layout;
  }
  
  /* Mobile content fitting */
  :global(.mobile-content-fit) {
    /* Ensure all child elements fit within container */
    width: 100%;
  }
  
  :global(.mobile-content-fit *) {
    /* Apply to all descendants */
    max-width: 100%;
    box-sizing: border-box;
  }
  
  /* Enhanced mobile-specific styles */
  @media (max-width: 767px) {
    :global(.responsive-container) {
      /* Tighter mobile constraints */
      max-width: 100vw;
      overflow-x: hidden;
      
      /* Ensure proper spacing on mobile */
      min-height: 0;
    }
    
    /* Prevent zoom on small screens */
    :global(.mobile-viewport-safe) {
      -webkit-text-size-adjust: 100%;
      -ms-text-size-adjust: 100%;
      text-size-adjust: 100%;
    }
  }
  
  /* Tablet and up optimizations */
  @media (min-width: 768px) {
    :global(.responsive-container) {
      /* Allow more flexible sizing on larger screens */
      contain: none;
    }
  }
  
  /* Handle edge cases for very small screens */
  @media (max-width: 320px) {
    :global(.responsive-container) {
      /* Ultra-small screen handling */
      padding-left: 0.75rem;
      padding-right: 0.75rem;
    }
  }
  
  /* Support for landscape mobile orientation */
  @media (max-height: 500px) and (orientation: landscape) {
    :global(.responsive-container) {
      /* Optimize for landscape mobile */
      padding-top: 0.5rem;
      padding-bottom: 0.5rem;
    }
  }
</style>