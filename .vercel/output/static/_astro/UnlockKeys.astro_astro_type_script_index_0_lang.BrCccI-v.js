const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/supabase.DCKg3lBM.js","_astro/index.C1Qlw3jS.js"])))=>i.map(i=>d[i]);
import{_ as y}from"./preload-helper.BlTxHScW.js";let o=null,s=null;async function m(){try{o=(await y(()=>import("./keyManager.R0xhbMgW.js"),[])).keyManager}catch(e){return console.error("Failed to load keyManager:",e),!1}try{s=(await y(()=>import("./supabase.DCKg3lBM.js"),__vite__mapDeps([0,1]))).supabase}catch(e){return console.error("Failed to load supabase:",e),!1}return!0}m().then(e=>{if(!e){console.error("Failed to initialize required modules");return}w()});function w(){const e=document.getElementById("unlock-keys-modal"),r=document.getElementById("unlock-password"),c=document.getElementById("unlock-keys-btn"),k=document.getElementById("cancel-unlock-btn"),d=document.getElementById("unlock-error"),h=document.getElementById("unlock-error-text"),a=document.getElementById("unlock-loading"),i=e.querySelector(".space-y-4");window.showUnlockKeys=()=>{e.classList.remove("hidden"),r.focus()};function l(){e.classList.add("hidden"),r.value="",d.classList.add("hidden"),a.classList.add("hidden"),i.classList.remove("hidden")}k?.addEventListener("click",l),c?.addEventListener("click",async()=>{const n=r.value.trim();if(!n){u("Please enter your encryption password");return}i.classList.add("hidden"),a.classList.remove("hidden");try{if(!s)throw new Error("Supabase not available");const{data:{session:t}}=await s.auth.getSession();if(!t)throw new Error("Not authenticated");await o.unlockKeys(t.user.id,n),l(),window.showNotification&&window.showNotification("Encryption keys unlocked successfully!","success",3e3),window.location.reload()}catch(t){console.error("Error unlocking keys:",t),a.classList.add("hidden"),i.classList.remove("hidden"),u(t.message||"Failed to unlock keys")}});function u(n){h.textContent=n,d.classList.remove("hidden")}r?.addEventListener("keypress",n=>{n.key==="Enter"&&c.click()}),window.addEventListener("load",async()=>{try{if(!s||!o)return;const{data:{session:n}}=await s.auth.getSession();if(!n)return;await o.hasEncryptionKeys(n.user.id)&&!o.isUnlocked&&document.querySelectorAll('[data-encrypted="true"]').length>0&&setTimeout(()=>{window.showUnlockKeys()},1500)}catch(n){console.error("Error checking encryption status:",n)}})}
