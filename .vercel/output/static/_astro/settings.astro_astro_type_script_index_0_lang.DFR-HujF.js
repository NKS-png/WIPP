import{supabase as n}from"./supabase.DCKg3lBM.js";import"./index.C1Qlw3jS.js";const p=document.getElementById("settings-form"),c=document.getElementById("avatar-upload"),u=document.getElementById("banner-upload"),g=document.getElementById("avatar-preview-new"),w=document.getElementById("banner-preview-new"),l=document.getElementById("save-btn"),m=document.getElementById("spinner");function f(i,e){i&&i.addEventListener("change",r=>{const o=r.target.files?.[0];if(o){const t=new FileReader;t.onload=a=>{e.src=a.target?.result,e.classList.remove("hidden")},t.readAsDataURL(o)}})}f(c,g);f(u,w);p?.addEventListener("submit",async i=>{i.preventDefault(),l.setAttribute("disabled","true"),l.classList.add("opacity-70","cursor-not-allowed"),m.classList.remove("hidden");try{const{data:{session:e}}=await n.auth.getSession();if(!e)throw new Error("Not logged in");const r={full_name:document.getElementById("full_name").value,username:document.getElementById("username").value,bio:document.getElementById("bio").value,website:document.getElementById("website").value,location:document.getElementById("location").value,updated_at:new Date};if(c.files?.length>0){const t=c.files[0],a=`${e.user.id}/avatar_${Date.now()}.${t.name.split(".").pop()}`,{error:s}=await n.storage.from("avatars").upload(a,t);if(s)throw s;const{data:d}=n.storage.from("avatars").getPublicUrl(a);r.avatar_url=d.publicUrl}if(u.files?.length>0){const t=u.files[0],a=`${e.user.id}/banner_${Date.now()}.${t.name.split(".").pop()}`,{error:s}=await n.storage.from("banners").upload(a,t);if(s)throw s;const{data:d}=n.storage.from("banners").getPublicUrl(a);r.banner_url=d.publicUrl}const{error:o}=await n.from("profiles").update(r).eq("id",e.user.id);if(o)throw o;alert("Settings saved successfully!"),window.location.href=`/profile/${e.user.id}`}catch(e){console.error(e),alert("Error updating profile: "+(e.message||"Unknown error")),l.removeAttribute("disabled"),l.classList.remove("opacity-70","cursor-not-allowed"),m.classList.add("hidden")}});
