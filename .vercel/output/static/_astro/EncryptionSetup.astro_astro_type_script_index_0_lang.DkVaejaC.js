const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/supabase.DCKg3lBM.js","_astro/index.C1Qlw3jS.js"])))=>i.map(i=>d[i]);
import{_ as y}from"./preload-helper.BlTxHScW.js";let i=null,d=null;async function L(){try{i=(await y(()=>import("./keyManager.R0xhbMgW.js"),[])).keyManager}catch(e){return console.error("Failed to load keyManager:",e),!1}try{d=(await y(()=>import("./supabase.DCKg3lBM.js"),__vite__mapDeps([0,1]))).supabase}catch(e){return console.error("Failed to load supabase:",e),!1}return!0}L().then(e=>{if(!e){console.error("Failed to initialize required modules");return}I()});function I(){const e=document.getElementById("encryption-setup-modal"),p=document.getElementById("setup-step-1"),c=document.getElementById("setup-step-2"),w=document.getElementById("setup-step-3"),l=document.getElementById("encryption-password"),r=document.getElementById("confirm-password"),g=document.getElementById("password-strength"),m=document.getElementById("strength-bar"),v=document.getElementById("strength-text"),f=document.getElementById("password-requirements"),E=document.getElementById("skip-encryption-btn"),u=document.getElementById("setup-encryption-btn"),b=document.getElementById("close-setup-btn");l?.addEventListener("input",t=>{const o=t.target.value;if(o.length>0){g.classList.remove("hidden");const s=i.validatePasswordStrength(o),a={"very-weak":"bg-red-500",weak:"bg-orange-500",medium:"bg-yellow-500",strong:"bg-blue-500","very-strong":"bg-green-500"},n={"very-weak":"20%",weak:"40%",medium:"60%",strong:"80%","very-strong":"100%"};m.className=`h-2 rounded-full transition-all duration-300 ${a[s.strength]}`,m.style.width=n[s.strength],v.textContent=s.strength.replace("-"," ").toUpperCase(),f.innerHTML=s.issues.map(h=>`<li class="flex items-center gap-2">
          <svg class="w-3 h-3 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
          ${h}
        </li>`).join(""),u.disabled=!s.isValid}else g.classList.add("hidden"),u.disabled=!0}),r?.addEventListener("input",t=>{const o=l.value,s=t.target.value;s.length>0?o===s?(r.classList.remove("border-red-500"),r.classList.add("border-green-500")):(r.classList.remove("border-green-500"),r.classList.add("border-red-500")):r.classList.remove("border-red-500","border-green-500")}),u?.addEventListener("click",async()=>{const t=l.value,o=r.value;if(t!==o){alert("Passwords do not match");return}if(!i.validatePasswordStrength(t).isValid){alert("Please use a stronger password");return}p.classList.add("hidden"),c.classList.remove("hidden");try{const a=await fetch("/api/encryption/check-migration");if(a.ok&&!(await a.json()).migrations_complete)throw new Error("Database not configured for encryption. Please run the SQL migrations first. See DATABASE_MIGRATION_INSTRUCTIONS.md");if(!d)throw new Error("Supabase not available");const{data:{session:n}}=await d.auth.getSession();if(!n)throw new Error("Not authenticated");await i.initializeUserEncryption(n.user.id,t),c.classList.add("hidden"),w.classList.remove("hidden")}catch(a){console.error("Error setting up encryption:",a);let n=a.message;n.includes("Database not configured")&&(n=`Database not ready for encryption.

Please run the SQL migrations first:
1. Go to your Supabase dashboard
2. Open SQL Editor
3. Run encryption-setup.sql
4. Run enhanced-security-schema.sql

See DATABASE_MIGRATION_INSTRUCTIONS.md for details.`),alert("Failed to set up encryption: "+n),c.classList.add("hidden"),p.classList.remove("hidden")}}),E?.addEventListener("click",()=>{e.classList.add("hidden"),localStorage.setItem("encryption-skipped","true")}),b?.addEventListener("click",()=>{e.classList.add("hidden")}),window.showEncryptionSetup=()=>{e.classList.remove("hidden")},window.addEventListener("load",async()=>{if(!localStorage.getItem("encryption-skipped"))try{if(!d||!i)return;const{data:{session:t}}=await d.auth.getSession();if(!t)return;await i.hasEncryptionKeys(t.user.id)||setTimeout(()=>{e.classList.remove("hidden")},2e3)}catch(t){console.error("Error checking encryption setup:",t)}})}
