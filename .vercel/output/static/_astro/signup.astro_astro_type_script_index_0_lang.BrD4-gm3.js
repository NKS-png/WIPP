import{supabase as o}from"./supabase.DCKg3lBM.js";import"./index.C1Qlw3jS.js";console.log("Auto encryption disabled for serverless compatibility");const c=new Audio("https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3");c.volume=.5;const L=document.getElementById("signup-form"),h=document.getElementById("avatar-upload"),B=document.getElementById("avatar-preview"),v=document.getElementById("avatar-img"),x=document.getElementById("avatar-icon"),d=document.getElementById("submitBtn"),w=document.getElementById("btnText"),y=document.getElementById("btnSpinner"),a=document.getElementById("statusMessage");let n=null;B?.addEventListener("click",()=>h.click());h.addEventListener("change",t=>{const e=t.target;if(e.files&&e.files[0]){n=e.files[0];const s=new FileReader;s.onload=i=>{i.target?.result&&(v.src=i.target.result,v.classList.remove("hidden"),x?.classList.add("hidden"),c.currentTime=0,c.play().catch(()=>{}))},s.readAsDataURL(n)}});L.addEventListener("submit",async t=>{t.preventDefault(),c.play().catch(()=>{});const e=document.getElementById("email").value,s=document.getElementById("password").value,i=document.getElementById("confirm-password").value,m=document.getElementById("full-name").value;if(a.className="hidden text-sm text-center py-2 rounded-lg mt-4",s!==i){u("Passwords do not match","error");return}b(!0);try{const{data:r,error:g}=await o.auth.signUp({email:e,password:s,options:{data:{full_name:m}}});if(g)throw g;if(!r.user)throw new Error("No user returned");const{error:p}=await o.from("profiles").upsert({id:r.user.id,email:e,full_name:m,updated_at:new Date().toISOString()},{onConflict:"id"});if(p&&console.warn("Manual profile creation warning:",p),n)try{const l=n.name.split(".").pop(),f=`${r.user.id}/avatar.${l}`,{error:E}=await o.storage.from("avatars").upload(f,n);if(!E){const{data:I}=o.storage.from("avatars").getPublicUrl(f);await o.from("profiles").update({avatar_url:I.publicUrl}).eq("id",r.user.id)}}catch(l){console.warn("Avatar upload skipped:",l)}console.log("Automatic encryption disabled for serverless compatibility"),u("Account created! Redirecting...","success"),setTimeout(()=>window.location.href="/login?message=Account created",1500)}catch(r){u(r.message||"Something went wrong","error"),b(!1)}});function b(t){t?(d.disabled=!0,d.classList.add("opacity-80","cursor-not-allowed"),w.textContent="Creating Account...",y.classList.remove("hidden")):(d.disabled=!1,d.classList.remove("opacity-80","cursor-not-allowed"),w.textContent="Create Account",y.classList.add("hidden"))}function u(t,e){a.textContent=t,a.classList.remove("hidden"),e==="error"?(a.classList.add("bg-red-50","text-red-500","border","border-red-100","animate-shake"),a.classList.remove("bg-green-50","text-green-500")):(a.classList.add("bg-green-50","text-green-500","border","border-green-100"),a.classList.remove("bg-red-50","text-red-500","animate-shake"))}
