---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout title="Test Conversation Access">
  <div class="max-w-4xl mx-auto py-8">
    <h1 class="text-3xl font-bold mb-8">Test Conversation Access</h1>
    
    <div class="space-y-6">
      <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-xl p-6">
        <h2 class="text-xl font-bold mb-4">Test Conversation Debug</h2>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-2">Conversation ID:</label>
            <input 
              type="text" 
              id="conversation-id" 
              placeholder="Enter conversation ID to test"
              class="w-full px-4 py-2 border border-neutral-200 dark:border-neutral-700 rounded-lg bg-neutral-50 dark:bg-neutral-800 text-neutral-900 dark:text-white"
            />
          </div>
          <button 
            id="test-conversation" 
            class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
          >
            Test Conversation Access
          </button>
        </div>
        
        <div id="test-results" class="mt-6 hidden">
          <h3 class="text-lg font-semibold mb-3">Test Results:</h3>
          <pre id="results-content" class="bg-neutral-100 dark:bg-neutral-800 p-4 rounded-lg text-sm overflow-auto max-h-96"></pre>
        </div>
      </div>

      <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-xl p-6">
        <h2 class="text-xl font-bold mb-4">Test Authentication</h2>
        <button 
          id="test-auth" 
          class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
        >
          Test Authentication Status
        </button>
        
        <div id="auth-results" class="mt-4 hidden">
          <pre id="auth-content" class="bg-neutral-100 dark:bg-neutral-800 p-4 rounded-lg text-sm overflow-auto max-h-96"></pre>
        </div>
      </div>

      <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-xl p-6">
        <h2 class="text-xl font-bold mb-4">Test Inbox Data</h2>
        <button 
          id="test-inbox" 
          class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
        >
          Test Inbox Data Access
        </button>
        
        <div id="inbox-results" class="mt-4 hidden">
          <pre id="inbox-content" class="bg-neutral-100 dark:bg-neutral-800 p-4 rounded-lg text-sm overflow-auto max-h-96"></pre>
        </div>
      </div>
    </div>
  </div>
</BaseLayout>

<script>
  // Test conversation access
  document.getElementById('test-conversation')?.addEventListener('click', async () => {
    const conversationId = (document.getElementById('conversation-id') as HTMLInputElement)?.value;
    
    if (!conversationId) {
      alert('Please enter a conversation ID');
      return;
    }

    try {
      const response = await fetch(`/api/debug-conversation?id=${encodeURIComponent(conversationId)}`);
      const data = await response.json();
      
      const resultsDiv = document.getElementById('test-results');
      const resultsContent = document.getElementById('results-content');
      
      if (resultsDiv && resultsContent) {
        resultsDiv.classList.remove('hidden');
        resultsContent.textContent = JSON.stringify(data, null, 2);
      }
    } catch (error) {
      alert('Error testing conversation: ' + error.message);
    }
  });

  // Test authentication
  document.getElementById('test-auth')?.addEventListener('click', async () => {
    try {
      const response = await fetch('/api/test-auth');
      const data = await response.json();
      
      const resultsDiv = document.getElementById('auth-results');
      const resultsContent = document.getElementById('auth-content');
      
      if (resultsDiv && resultsContent) {
        resultsDiv.classList.remove('hidden');
        resultsContent.textContent = JSON.stringify(data, null, 2);
      }
    } catch (error) {
      alert('Error testing auth: ' + error.message);
    }
  });

  // Test inbox data
  document.getElementById('test-inbox')?.addEventListener('click', async () => {
    try {
      const response = await fetch('/api/debug-inbox');
      const data = await response.json();
      
      const resultsDiv = document.getElementById('inbox-results');
      const resultsContent = document.getElementById('inbox-content');
      
      if (resultsDiv && resultsContent) {
        resultsDiv.classList.remove('hidden');
        resultsContent.textContent = JSON.stringify(data, null, 2);
      }
    } catch (error) {
      alert('Error testing inbox: ' + error.message);
    }
  });
</script>
</BaseLayout>